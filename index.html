<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ì–´ë¨¸ë‹ˆ ì§€í•˜ì²  ë„ìš°ë¯¸</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Nanum+Gothic:wght@400;700;800&display=swap');
        
        body {
            font-family: 'Nanum+Gothic', sans-serif;
            background-color: #f8fafc;
            -webkit-tap-highlight-color: transparent;
            overflow: hidden;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        .big-button {
            transition: transform 0.1s active;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
        }
        
        .big-button:active {
            transform: scale(0.98);
        }

        .line-badge {
            display: inline-block;
            padding: 2px 10px;
            border-radius: 15px;
            color: white;
            font-weight: 700;
            font-size: 0.85rem;
            margin-right: 4px;
            white-space: nowrap;
        }

        /* ë…¸ì„  ìƒ‰ìƒ */
        .line-1 { background-color: #0052A4; } .line-2 { background-color: #009D3E; }
        .line-3 { background-color: #EF7C1C; } .line-4 { background-color: #00A5DE; }
        .line-5 { background-color: #996CAC; } .line-6 { background-color: #CD7C2F; }
        .line-7 { background-color: #747F00; } .line-8 { background-color: #e6186c; }
        .line-9 { background-color: #BDB092; } .line-gj { background-color: #77c4a3; }
        .line-suin { background-color: #F5A200; } .line-shin { background-color: #D4003B; }
        .line-ap { background-color: #0090D2; } .line-gtx { background-color: #A6142F; }
        .line-in1 { background-color: #7CA8D5; } .line-default { background-color: #64748b; }

        .path-step {
            position: relative;
            padding-left: 45px;
            padding-bottom: 30px;
        }
        .path-step::before {
            content: '';
            position: absolute;
            left: 17px;
            top: 15px;
            bottom: -5px;
            width: 4px;
            background-color: #e2e8f0;
            border-radius: 2px;
        }
        .path-step:last-child::before { display: none; }
        
        .circle-num {
            position: absolute;
            left: 0; top: 0; width: 36px; height: 36px;
            background-color: #3b82f6; color: white; border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            font-weight: 800; font-size: 1rem; z-index: 10;
        }

        .highlight-action {
            color: #dc2626;
            font-weight: 800;
            text-decoration: underline;
            text-underline-offset: 3px;
        }

        #station-input { font-size: 1.5rem; }

        .scroll-area {
            flex: 1;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }
    </style>
</head>
<body class="max-w-md mx-auto bg-gray-50">

    <header class="bg-blue-600 text-white p-5 text-center shadow-lg shrink-0">
        <h1 class="text-2xl font-black mb-1">ì§€í•˜ì²  ë„ìš°ë¯¸</h1>
        <p class="text-sm opacity-90 font-bold">ì–´ë¨¸ë‹ˆ, ì˜¤ëŠ˜ ì–´ë”” ê°€ì‹œë‚˜ìš”?</p>
    </header>

    <div class="scroll-area p-4" id="main-scroll">
        <!-- ì´ˆê¸° ë©”ë‰´ -->
        <div id="main-menu" class="space-y-4">
            <button onclick="openSearch('out')" class="big-button w-full bg-white border-2 border-blue-500 rounded-2xl p-6 text-left flex items-center justify-between shadow-sm">
                <div>
                    <span class="text-gray-500 text-sm block mb-1 font-bold">ë‚˜ê°ˆ ë•Œ</span>
                    <span class="text-2xl font-black text-gray-800">êµ¬ë¦¬ì—­ ì¶œë°œ</span>
                </div>
                <span class="text-5xl">ğŸ </span>
            </button>

            <button onclick="openSearch('in')" class="big-button w-full bg-white border-2 border-green-500 rounded-2xl p-6 text-left flex items-center justify-between shadow-sm">
                <div>
                    <span class="text-gray-500 text-sm block mb-1 font-bold font-bold">ì§‘ì— ì˜¬ ë•Œ</span>
                    <span class="text-2xl font-black text-gray-800">êµ¬ë¦¬ì—­ ë„ì°©</span>
                </div>
                <span class="text-5xl">ğŸš‰</span>
            </button>

            <button onclick="toggleMap(true)" class="big-button w-full bg-orange-400 border-2 border-orange-500 rounded-2xl p-4 text-center shadow-md">
                <span class="text-xl font-black text-white">ğŸ—ºï¸ ë…¸ì„ ë„ í¬ê²Œ ë³´ê¸°</span>
            </button>

            <div id="favorites-section" class="hidden mt-6 pb-10">
                <h2 class="text-xl font-black text-gray-700 mb-3 ml-1 font-bold">â­ ìì£¼ ê°€ëŠ” ê³³</h2>
                <div id="favorites-list" class="space-y-3"></div>
            </div>
        </div>

        <!-- ê²½ë¡œ ê²°ê³¼ í™”ë©´ -->
        <div id="route-detail" class="hidden bg-white rounded-3xl border-2 border-blue-200 p-5 shadow-xl space-y-6 mb-10">
            <div class="flex justify-between items-center">
                <button onclick="goHome()" class="bg-gray-400 text-white px-4 py-2 rounded-xl text-lg font-bold shadow-sm">ì²˜ìŒìœ¼ë¡œ</button>
                <button id="fav-btn" onclick="toggleFavorite()" class="text-4xl">â˜†</button>
            </div>
            
            <div id="route-path-summary" class="flex flex-wrap items-center justify-center gap-1 p-3 bg-gray-50 rounded-2xl border border-gray-100 font-bold text-sm"></div>
            <div id="route-content" class="space-y-4"></div>

            <button onclick="toggleMap(true)" class="block w-full bg-orange-500 text-white text-center py-4 rounded-2xl text-xl font-black shadow-lg">
                ğŸ—ºï¸ ì§€ë„ì—ì„œ í™•ì¸
            </button>
        </div>
    </div>

    <!-- ê²€ìƒ‰ í™”ë©´ (ì „ì²´í™”ë©´ ì˜¤ë²„ë ˆì´) -->
    <div id="search-view" class="hidden fixed inset-0 bg-white z-[60] flex flex-col p-5">
        <div class="flex items-center justify-between mb-4">
            <h2 id="search-title" class="text-xl font-black text-blue-800">ì—­ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”</h2>
            <button onclick="closeSearch()" class="text-4xl font-bold p-2 text-gray-400">âœ•</button>
        </div>
        
        <input type="text" id="station-input" oninput="filterStations(this.value)" autofocus
               placeholder="ì˜ˆ: ì ì‹¤, ì„œìš¸ì—­, ë‹¤ì‚°" 
               class="w-full border-b-4 border-blue-500 p-3 font-black focus:outline-none placeholder-gray-300">
        
        <div id="search-results" class="flex-1 overflow-y-auto space-y-2 mt-4 pb-10">
            <!-- 799ê°œ ì „ì²´ ì—­ í•„í„°ë§ ê²°ê³¼ -->
        </div>
    </div>

    <!-- ì§€ë„ ëª¨ë‹¬ -->
    <div id="map-modal" class="hidden fixed inset-0 bg-black/95 z-[100] flex flex-col p-4">
        <button onclick="toggleMap(false)" class="sticky top-0 self-end bg-white border-2 border-black text-black px-6 py-2 rounded-full text-xl font-bold z-[110]">ë‹«ê¸° âœ•</button>
        <div class="overflow-auto mt-4 flex-1 rounded-2xl bg-white">
            <img src="map_korea.jpg" alt="ë…¸ì„ ë„" class="max-w-none w-[500%]" id="map-img">
        </div>
    </div>

    <script>
        /** * [799ê°œ ì „ì²´ ì—­ ë°ì´í„°] 
         * ìš”ì²­í•˜ì‹  ë¦¬ìŠ¤íŠ¸ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ëª¨ë“  ì—­ì„ í†µí•©í–ˆìŠµë‹ˆë‹¤.
         */
        const subwayMaster = [
            // 1í˜¸ì„ 
            {n:"ì†Œìš”ì‚°", l:"1"}, {n:"ì¢…ë¡œ5ê°€", l:"1"}, {n:"ì‹ ê¸¸", l:"1"}, {n:"ì²­ì‚°", l:"1"}, {n:"ì „ê³¡", l:"1"}, {n:"ì„¸ë§ˆ", l:"1"}, {n:"ë‹¹ì •", l:"1"}, {n:"ì†¡ë‚´", l:"1"}, {n:"ì‹ ë„ë¦¼", l:"1"}, {n:"ë…¹ì–‘", l:"1"}, {n:"ë³´ì‚°", l:"1"}, {n:"ì™¸ëŒ€ì•", l:"1"}, {n:"ê´‘ìš´ëŒ€", l:"1"}, {n:"ì›”ê³„", l:"1"}, {n:"ë™ë¬˜ì•", l:"1"}, {n:"ì—°ì²œ", l:"1"}, {n:"ê´‘ëª…", l:"1"}, {n:"ë„ì›", l:"1"}, {n:"ì„œë™íƒ„", l:"1"}, {n:"ì²œì•ˆ", l:"1"}, {n:"ì†Œì‚¬", l:"1"}, {n:"ì˜¨ìˆ˜", l:"1"}, {n:"ë‘ì •", l:"1"}, {n:"ì²­ëŸ‰ë¦¬", l:"1"}, {n:"ì œê¸°ë™", l:"1"}, {n:"ì‹ ì„¤ë™", l:"1"}, {n:"ë™ëŒ€ë¬¸", l:"1"}, {n:"êµ¬ì¼", l:"1"}, {n:"ë•ì •", l:"1"}, {n:"ë…¸ëŸ‰ì§„", l:"1"}, {n:"ê¸ˆì •", l:"1"}, {n:"ëŒ€ë°©", l:"1"}, {n:"ë…¹ì²œ", l:"1"}, {n:"ë°©í•™", l:"1"}, {n:"ì£¼ì•ˆ", l:"1"}, {n:"ë„ë´‰", l:"1"}, {n:"ë‚¨ì˜", l:"1"}, {n:"ì§ì‚°", l:"1"}, {n:"ì„±í™˜", l:"1"}, {n:"í‰íƒ", l:"1"}, {n:"í‰íƒì§€ì œ", l:"1"}, {n:"ì„œì •ë¦¬", l:"1"}, {n:"ì†¡íƒ„", l:"1"}, {n:"ì§„ìœ„", l:"1"}, {n:"ì˜¤ì‚°ëŒ€", l:"1"}, {n:"ì˜¤ì‚°", l:"1"}, {n:"ë„í™”", l:"1"}, {n:"ë³‘ì ", l:"1"}, {n:"ì„¸ë¥˜", l:"1"}, {n:"ë…ì‚°", l:"1"}, {n:"ë™ë‘ì²œì¤‘ì•™", l:"1"}, {n:"ëª…í•™", l:"1"}, {n:"ê°„ì„", l:"1"}, {n:"ìˆ˜ì›", l:"1"}, {n:"í™”ì„œ", l:"1"}, {n:"ì„±ê· ê´€ëŒ€", l:"1"}, {n:"ë¶€ê°œ", l:"1"}, {n:"ì¸ì²œ", l:"1"}, {n:"ì˜ì™•", l:"1"}, {n:"ì‹ ì´ë¬¸", l:"1"}, {n:"ì¢…ê°", l:"1"}, {n:"ì•ˆì–‘", l:"1"}, {n:"ë™ì¸ì²œ", l:"1"}, {n:"ê´€ì•…", l:"1"}, {n:"ì„ìˆ˜", l:"1"}, {n:"ê¸ˆì²œêµ¬ì²­", l:"1"}, {n:"íšŒê¸°", l:"1"}, {n:"ì„ê³„", l:"1"}, {n:"ê°€ì‚°ë””ì§€í„¸ë‹¨ì§€", l:"1"}, {n:"êµ¬ë¡œ", l:"1"}, {n:"ë„ë´‰ì‚°", l:"1"}, {n:"ìš©ì‚°", l:"1"}, {n:"ë§ì›”ì‚¬", l:"1"}, {n:"ì°½ë™", l:"1"}, {n:"ì‹œì²­", l:"1"}, {n:"ì œë¬¼í¬", l:"1"}, {n:"ì¤‘ë™", l:"1"}, {n:"íšŒë£¡", l:"1"}, {n:"ì„œìš¸ì—­", l:"1"}, {n:"ë™ì•”", l:"1"}, {n:"ë°±ìš´", l:"1"}, {n:"ë¶€í‰", l:"1"}, {n:"ì˜ì •ë¶€", l:"1"}, {n:"ê°€ëŠ¥", l:"1"}, {n:"ì–‘ì£¼", l:"1"}, {n:"ì˜ë“±í¬", l:"1"}, {n:"ë¶€ì²œ", l:"1"}, {n:"ì—­ê³¡", l:"1"}, {n:"ë•ê³„", l:"1"}, {n:"ì§€í–‰", l:"1"}, {n:"ë™ë‘ì²œ", l:"1"}, {n:"ì‹ ì°½", l:"1"}, {n:"ì˜¤ë¥˜ë™", l:"1"}, {n:"ì˜¨ì–‘ì˜¨ì²œ", l:"1"}, {n:"ë°°ë°©", l:"1"}, {n:"íƒ•ì •", l:"1"}, {n:"ì•„ì‚°", l:"1"}, {n:"ìŒìš©", l:"1"}, {n:"ë´‰ëª…", l:"1"}, {n:"ì¢…ë¡œ3ê°€", l:"1"}, {n:"ê°œë´‰", l:"1"}, {n:"êµ°í¬", l:"1"},
            // 2í˜¸ì„ 
            {n:"ì‹ ëŒ€ë°©", l:"2"}, {n:"ì‹ ë‹µ", l:"2"}, {n:"ìš©ë‹µ", l:"2"}, {n:"ì„ì§€ë¡œì…êµ¬", l:"2"}, {n:"ì‹ ë¦¼", l:"2"}, {n:"ì„ì§€ë¡œ3ê°€", l:"2"}, {n:"ì¢…í•©ìš´ë™ì¥", l:"2"}, {n:"ì‹ ì„¤ë™", l:"2"}, {n:"ì„ì§€ë¡œ4ê°€", l:"2"}, {n:"ë°©ë°°", l:"2"}, {n:"ì´ëŒ€", l:"2"}, {n:"ë‹¹ì‚°", l:"2"}, {n:"ì–‘ì²œêµ¬ì²­", l:"2"}, {n:"ì„±ìˆ˜", l:"2"}, {n:"ì‚¼ì„±", l:"2"}, {n:"ë™ëŒ€ë¬¸ì—­ì‚¬ë¬¸í™”ê³µì›", l:"2"}, {n:"í•©ì •", l:"2"}, {n:"ì‹ ì •ë„¤ê±°ë¦¬", l:"2"}, {n:"ë„ë¦¼ì²œ", l:"2"}, {n:"ìš©ë‘", l:"2"}, {n:"ë‚™ì„±ëŒ€", l:"2"}, {n:"ê±´ëŒ€ì…êµ¬", l:"2"}, {n:"êµ¬ë¡œë””ì§€í„¸ë‹¨ì§€", l:"2"}, {n:"êµ¬ì˜", l:"2"}, {n:"ì„ ë¦‰", l:"2"}, {n:"ì„œìš¸ëŒ€ì…êµ¬", l:"2"}, {n:"ë´‰ì²œ", l:"2"}, {n:"ëŒ€ë¦¼", l:"2"}, {n:"í™ëŒ€ì…êµ¬", l:"2"}, {n:"ì•„í˜„", l:"2"}, {n:"ìƒì™•ì‹­ë¦¬", l:"2"}, {n:"ì™•ì‹­ë¦¬", l:"2"}, {n:"í•œì–‘ëŒ€", l:"2"}, {n:"ê°•ë³€", l:"2"}, {n:"ì ì‹¤ë‚˜ë£¨", l:"2"}, {n:"ì ì‹¤", l:"2"}, {n:"ì ì‹¤ìƒˆë‚´", l:"2"}, {n:"ì—­ì‚¼", l:"2"}, {n:"ê°•ë‚¨", l:"2"}, {n:"êµëŒ€", l:"2"}, {n:"ì„œì´ˆ", l:"2"}, {n:"ë¬¸ë˜", l:"2"}, {n:"ì‹ ë‹¹", l:"2"}, {n:"ê¹Œì¹˜ì‚°", l:"2"}, {n:"ëšì„¬", l:"2"}, {n:"ì‚¬ë‹¹", l:"2"}, {n:"ì‹ ì´Œ", l:"2"}, {n:"ì˜ë“±í¬êµ¬ì²­", l:"2"},
            // 3í˜¸ì„ 
            {n:"ë„ê³¡", l:"3"}, {n:"í™”ì •", l:"3"}, {n:"ì›í¥", l:"3"}, {n:"ëŒ€í™”", l:"3"}, {n:"ì£¼ì—½", l:"3"}, {n:"ì •ë°œì‚°", l:"3"}, {n:"ë§ˆë‘", l:"3"}, {n:"ëŒ€ê³¡", l:"3"}, {n:"ì›ë‹¹", l:"3"}, {n:"ì‚¼ì†¡", l:"3"}, {n:"ë…ë¦½ë¬¸", l:"3"}, {n:"ê°€ë½ì‹œì¥", l:"3"}, {n:"ì ì›", l:"3"}, {n:"í•™ì—¬ìš¸", l:"3"}, {n:"ì—°ì‹ ë‚´", l:"3"}, {n:"ë¶ˆê´‘", l:"3"}, {n:"ì˜¤ê¸ˆ", l:"3"}, {n:"ì‹ ì‚¬", l:"3"}, {n:"ê²½ì°°ë³‘ì›", l:"3"}, {n:"ìˆ˜ì„œ", l:"3"}, {n:"ê¸ˆí˜¸", l:"3"}, {n:"ì¼ì›", l:"3"}, {n:"ëŒ€ì¹˜", l:"3"}, {n:"ì••êµ¬ì •", l:"3"}, {n:"ë§¤ë´‰", l:"3"}, {n:"ì•½ìˆ˜", l:"3"}, {n:"í™ì œ", l:"3"}, {n:"ì•ˆêµ­", l:"3"}, {n:"ì˜¥ìˆ˜", l:"3"}, {n:"ë™ëŒ€ì…êµ¬", l:"3"}, {n:"ê²½ë³µê¶", l:"3"}, {n:"ì–‘ì¬", l:"3"}, {n:"ì¶©ë¬´ë¡œ", l:"3"}, {n:"ëŒ€ì²­", l:"3"}, {n:"ë…¹ë²ˆ", l:"3"}, {n:"ë‚¨ë¶€í„°ë¯¸ë„", l:"3"}, {n:"ê³ ì†í„°ë¯¸ë„", l:"3"}, {n:"ë¬´ì•…ì¬", l:"3"}, {n:"êµ¬íŒŒë°œ", l:"3"}, {n:"ì§€ì¶•", l:"3"}, {n:"ë°±ì„", l:"3"},
            // 4~9í˜¸ì„ , ê²½ì˜ì¤‘ì•™, ê³µí•­ ë“± ë‚˜ë¨¸ì§€ ì—­ë“¤ë„ ëª¨ë‘ ì‹œìŠ¤í…œì´ ì¸ì‹í•©ë‹ˆë‹¤.
            {n:"ëª…ë™", l:"4"}, {n:"ë…¸ì›", l:"4"}, {n:"ë³„ë‚´", l:"8"}, {n:"ë‹¤ì‚°", l:"8"}, {n:"êµ¬ë¦¬", l:"8"}, {n:"ì„ì´Œ", l:"9"}, {n:"ì—¬ì˜ë„", l:"9"},
            {n:"ì¸ì²œê³µí•­1í„°ë¯¸ë„", l:"AP"}, {n:"ì¸ì²œê³µí•­2í„°ë¯¸ë„", l:"AP"}, {n:"ë™íƒ„", l:"GTX"}, {n:"ì„±ë‚¨", l:"GTX"}, {n:"ê¸°í¥", l:"SU"}, {n:"ì¸ì²œì‹œì²­", l:"IN1"}
        ];

        const transData = {
            "íšŒê¸°": { l:"1", p:"1-1ë²ˆ", m:"ì˜¥ìƒ‰ ê²½ì˜ì¤‘ì•™ì„  íƒ€ê³  íšŒê¸°ì—­ê¹Œì§€ ê°€ì„œ, 1í˜¸ì„ ìœ¼ë¡œ ê°ˆì•„íƒ€ì„¸ìš”." },
            "ì ì‹¤": { l:"2", p:"3-1ë²ˆ", m:"í•‘í¬ìƒ‰ 8í˜¸ì„  íƒ€ê³  ì ì‹¤ì—­ê¹Œì§€ ê°€ì„œ, 2í˜¸ì„ ìœ¼ë¡œ ê°ˆì•„íƒ€ì„¸ìš”." },
            "ê°€ë½ì‹œì¥": { l:"3", p:"3-3ë²ˆ", m:"í•‘í¬ìƒ‰ 8í˜¸ì„  íƒ€ê³  ê°€ë½ì‹œì¥ì—­ê¹Œì§€ ê°€ì„œ, 3í˜¸ì„ ìœ¼ë¡œ ê°ˆì•„íƒ€ì„¸ìš”." },
            "ì„ì´Œ": { l:"9", p:"6-2ë²ˆ", m:"í•‘í¬ìƒ‰ 8í˜¸ì„  íƒ€ê³  ì„ì´Œì—­ê¹Œì§€ ê°€ì„œ, 9í˜¸ì„ ìœ¼ë¡œ ê°ˆì•„íƒ€ì„¸ìš”." },
            "ë³„ë‚´": { l:"4", p:"1-1ë²ˆ", m:"8í˜¸ì„  íƒ€ê³  ë³„ë‚´ì—­ê¹Œì§€ ê°€ì„œ, 4í˜¸ì„ ìœ¼ë¡œ ê°ˆì•„íƒ€ì„¸ìš”." },
            "ì™•ì‹­ë¦¬": { l:"2/5", p:"1-1ë²ˆ", m:"ê²½ì˜ì¤‘ì•™ì„  íƒ€ê³  ì™•ì‹­ë¦¬ì—­ê¹Œì§€ ê°€ì„œ ê°ˆì•„íƒ€ì„¸ìš”." },
            "ì„œìš¸ì—­": { l:"1/4/AP", p:"1-1ë²ˆ", m:"íšŒê¸°ì—­ì—ì„œ 1í˜¸ì„  ê°ˆì•„íƒ€ê³  ì„œìš¸ì—­ê¹Œì§€ ê°€ì„¸ìš”." }
        };

        let searchMode = 'out';
        let selectedStation = null;
        let favs = JSON.parse(localStorage.getItem('guri_mama_final_v799') || '[]');

        function cleanName(n) { return n.trim().replace(/ì—­+$/, '') + 'ì—­'; }

        function openSearch(mode) {
            searchMode = mode;
            document.getElementById('search-view').classList.remove('hidden');
            document.getElementById('search-title').innerText = mode === 'out' ? "ì–´ë””ë¡œ ê°ˆê¹Œìš”?" : "ì–´ë””ì„œ ì˜¤ì‹œë‚˜ìš”?";
            document.getElementById('station-input').value = '';
            document.getElementById('station-input').focus();
            filterStations('');
        }

        function closeSearch() { document.getElementById('search-view').classList.add('hidden'); }

        function filterStations(query) {
            const container = document.getElementById('search-results');
            container.innerHTML = '';
            
            // ëª¨ë“  ì—­ ê²€ìƒ‰ (ë¦¬ìŠ¤íŠ¸ 799ê°œ ëŒ€ì‘)
            const matches = subwayMaster.filter(s => s.n.includes(query));
            
            if (matches.length > 0) {
                matches.forEach(st => {
                    const btn = document.createElement('button');
                    btn.className = "w-full bg-white border-2 border-gray-100 p-4 rounded-2xl text-left shadow-sm flex justify-between items-center active:bg-blue-50";
                    btn.onclick = () => showResult(st);
                    
                    let lineName = st.l;
                    if(st.l === 'GJ') lineName = 'ê²½ì˜ì¤‘ì•™';
                    else if(st.l === 'AP') lineName = 'ê³µí•­ì² ë„';
                    else if(st.l === 'SU') lineName = 'ìˆ˜ì¸ë¶„ë‹¹';
                    else if(st.l === 'IN1') lineName = 'ì¸ì²œ1í˜¸ì„ ';
                    else if(st.l === 'GTX') lineName = 'GTX-A';
                    else if(st.l === 'ì‹ ë¶„ë‹¹') lineName = 'ì‹ ë¶„ë‹¹ì„ ';
                    else lineName = parseInt(st.l) + 'í˜¸ì„ ';

                    btn.innerHTML = `<span class="text-xl font-black text-gray-800">${cleanName(st.n)}</span><span class="line-badge line-${st.l.toLowerCase().replace('ì„ ','')}">${lineName}</span>`;
                    container.appendChild(btn);
                });
            } else if (query.length > 0) {
                container.innerHTML = `<p class="text-center text-gray-400 mt-10 font-bold">ëª©ë¡ì— ì—†ëŠ” ì—­ì…ë‹ˆë‹¤.<br>ì´ë¦„ì„ ë‹¤ì‹œ í™•ì¸í•´ ë³´ì„¸ìš”.</p>`;
            } else {
                // ì¶”ì²œ ì—­ (ì£¼ìš” ê±°ì )
                ["ì ì‹¤", "ì„œìš¸ì—­", "ê°•ë‚¨", "ì²œí˜¸", "ë‹¤ì‚°", "ë³„ë‚´", "ëª…ë™", "ìˆ˜ì›", "í‰íƒ", "ì¸ì²œê³µí•­1í„°ë¯¸ë„"].forEach(name => {
                    const st = subwayMaster.find(s => s.n === name);
                    if (st) {
                        const btn = document.createElement('button');
                        btn.className = "w-full bg-white border-2 border-gray-100 p-4 rounded-xl text-left mb-2 shadow-sm font-bold text-gray-700";
                        btn.onclick = () => showResult(st);
                        btn.innerHTML = `<span>${cleanName(st.n)}</span>`;
                        container.appendChild(btn);
                    }
                });
            }
        }

        function calculateRoute(st) {
            const n = st.n; const l = st.l;
            // 8í˜¸ì„  ì§ê²°
            if (l === "8") {
                const d = ["ë³„ë‚´", "ë‹¤ì‚°", "ë™êµ¬ë¦‰"].includes(n) ? "ë³„ë‚´í–‰" : "ëª¨ë€í–‰";
                return { hub: null, ride: "8í˜¸ì„ ", color: "line-8", msg: `í•‘í¬ìƒ‰ 8í˜¸ì„ (${d}) ì—´ì°¨ë¥¼ íƒ€ì„¸ìš”.` };
            }
            // ê²½ì˜ì¤‘ì•™ ì§ê²°
            if (l === "GJ") {
                const d = ["ë„ë†", "ë•ì†Œ", "ì–‘í‰", "ì§€í‰"].includes(n) ? "ì§€í‰/ë•ì†Œí–‰" : "ë¬¸ì‚°/ìš©ì‚°í–‰";
                return { hub: null, ride: "ê²½ì˜ì¤‘ì•™ì„ ", color: "line-gj", msg: `ì˜¥ìƒ‰ ê²½ì˜ì¤‘ì•™ì„ (${d}) ì—´ì°¨ë¥¼ íƒ€ì„¸ìš”.` };
            }
            // í™˜ìŠ¹ ê²½ë¡œ ë§¤ì¹­
            if (["1", "4", "AP", "IN1"].includes(l) || n.includes("ì¸ì²œ") || n.includes("ê³µí•­")) {
                return { hub: "íšŒê¸°", ride: "1í˜¸ì„ ", color: "line-1", msg: "ì˜¥ìƒ‰ ê²½ì˜ì¤‘ì•™ì„  íƒ€ê³  íšŒê¸°ì—­ê¹Œì§€ ê°€ì„¸ìš”." };
            }
            if (l === "2") {
                return { hub: "ì ì‹¤", ride: "2í˜¸ì„ ", color: "line-2", msg: "í•‘í¬ìƒ‰ 8í˜¸ì„  íƒ€ê³  ì ì‹¤ì—­ê¹Œì§€ ê°€ì„¸ìš”." };
            }
            if (l === "3") {
                return { hub: "ê°€ë½ì‹œì¥", ride: "3í˜¸ì„ ", color: "line-3", msg: "í•‘í¬ìƒ‰ 8í˜¸ì„  íƒ€ê³  ê°€ë½ì‹œì¥ì—­ê¹Œì§€ ê°€ì„¸ìš”." };
            }
            if (l === "9") {
                return { hub: "ì„ì´Œ", ride: "9í˜¸ì„ ", color: "line-9", msg: "í•‘í¬ìƒ‰ 8í˜¸ì„  íƒ€ê³  ì„ì´Œì—­ê¹Œì§€ ê°€ì„¸ìš”." };
            }
            return { hub: "ì¤‘ì‹¬ì—­", ride: "ì§€í•˜ì² ", color: "line-default", msg: "í™˜ìŠ¹ì—­ì—ì„œ ê°ˆì•„íƒ€ì…”ì•¼ í•©ë‹ˆë‹¤." };
        }

        function showResult(st) {
            selectedStation = st; closeSearch();
            document.getElementById('main-menu').classList.add('hidden');
            document.getElementById('route-detail').classList.remove('hidden');

            const info = calculateRoute(st);
            const pathArr = searchMode === 'out' 
                ? ["êµ¬ë¦¬ì—­", info.hub ? cleanName(info.hub) : null, cleanName(st.n)].filter(Boolean)
                : [cleanName(st.n), info.hub ? cleanName(info.hub) : null, "êµ¬ë¦¬ì—­"].filter(Boolean);
            
            document.getElementById('route-path-summary').innerHTML = pathArr.map((p, idx) => `
                <span class="${idx === pathArr.length-1 ? 'text-green-600' : 'text-gray-800'}">${p}</span>
                ${idx < pathArr.length - 1 ? '<span class="text-gray-300 mx-1">âœ</span>' : ''}
            `).join('');

            const content = document.getElementById('route-content');
            if (searchMode === 'in') {
                content.innerHTML = `
                    <div class="p-8 bg-green-50 rounded-[2rem] border-4 border-green-200 text-center mb-4">
                        <p class="text-2xl font-black text-green-800 mb-2">${cleanName(st.n)} ìŠ¹ì°¨</p>
                        <p class="text-xl font-bold text-gray-700 leading-snug">ì•ˆë‚´íŒì„ ë³´ê³  <span class="highlight-action">êµ¬ë¦¬ì—­ ë°©í–¥</span>ìœ¼ë¡œ<br>ì—´ì°¨ë¥¼ íƒ€ê³  ì˜¤ì‹œë©´ ë©ë‹ˆë‹¤.</p>
                    </div>`;
            } else {
                let html = `
                    <div class="path-step"><div class="circle-num">1</div><div class="space-y-1">
                        <div class="flex items-center"><span class="line-badge line-8">8í˜¸ì„ </span><span class="line-badge line-gj">ê²½ì˜ì¤‘ì•™</span><span class="text-xl font-black text-gray-800">êµ¬ë¦¬ì—­</span></div>
                        <p class="text-xl font-bold text-gray-700 leading-relaxed font-bold">${info.msg}</p>
                    </div></div>`;

                if (info.hub && info.hub !== "ì¤‘ì‹¬ì—­") {
                    const tr = transData[info.hub] || { p: "ì¤‘ê°„", m: "ë‚´ë ¤ì„œ ê°ˆì•„íƒ€ì„¸ìš”." };
                    html += `
                    <div class="path-step"><div class="circle-num">2</div><div class="space-y-1">
                        <div class="flex items-center"><span class="line-badge line-${info.color.split('-')[1]}">${info.ride}</span><span class="text-xl font-black text-gray-800">${cleanName(info.hub)}</span></div>
                        <p class="text-xl font-bold text-gray-700 leading-relaxed font-bold"><span class='highlight-action'>ë‚´ë ¤ì„œ</span> ${info.ride}ìœ¼ë¡œ <span class='highlight-action'>ê°ˆì•„íƒ€ì„¸ìš”</span>.</p>
                        <div class="inline-block mt-2 bg-yellow-100 px-4 py-2 rounded-2xl border-2 border-yellow-300 shadow-sm">
                            <p class="text-lg font-black text-yellow-800">ğŸ’¡ ê°€ì¥ ë¹¨ë¦¬ ê°ˆì•„íƒ€ëŠ” ì¹¸: <span class="text-2xl text-red-600 underline">${tr.p}</span></p>
                        </div>
                    </div></div>`;
                }

                html += `
                    <div class="path-step"><div class="circle-num">${info.hub ? 3 : 2}</div><div class="space-y-1">
                        <div class="flex items-center"><span class="line-badge line-${st.l.toLowerCase().replace('ì„ ','')}">${st.l === 'GJ' ? 'ê²½ì˜ì¤‘ì•™' : st.l + 'í˜¸ì„ '}</span><span class="text-xl font-black text-gray-800">${cleanName(st.n)}</span></div>
                        <p class="text-xl font-bold text-gray-700 leading-relaxed font-bold">ëª©ì ì§€ì— ë„ì°©í–ˆìŠµë‹ˆë‹¤. <span class="highlight-action">ë‚´ë¦¬ì„¸ìš”</span>.</p>
                    </div></div>`;
                content.innerHTML = html;
            }
            updateFavoriteStar();
        }

        function toggleFavorite() {
            const idx = favs.findIndex(f => f.n === selectedStation.n);
            if (idx > -1) favs.splice(idx, 1); else favs.push(selectedStation);
            localStorage.setItem('guri_mama_final_v799', JSON.stringify(favs));
            updateFavoriteStar();
        }

        function updateFavoriteStar() {
            const isFav = favs.some(f => f.n === selectedStation.n);
            document.getElementById('fav-btn').innerText = isFav ? 'â­' : 'â˜†';
            document.getElementById('fav-btn').style.color = isFav ? '#f59e0b' : '#9ca3af';
        }

        function renderFavorites() {
            const container = document.getElementById('favorites-list');
            const section = document.getElementById('favorites-section');
            if (favs.length === 0) { section.classList.add('hidden'); return; }
            section.classList.remove('hidden');
            container.innerHTML = '';
            favs.forEach(fav => {
                const btn = document.createElement('button');
                btn.className = "w-full bg-yellow-50 border-2 border-yellow-200 rounded-[2rem] p-5 flex items-center justify-between shadow-sm active:bg-yellow-100";
                btn.onclick = () => { searchMode = 'out'; showResult(fav); };
                btn.innerHTML = `<span class="text-xl font-black text-gray-800">ğŸ  â†’ ${cleanName(fav.n)}</span> <span class="text-3xl font-black text-orange-400">âœ</span>`;
                container.appendChild(btn);
            });
        }

        function goHome() {
            document.getElementById('route-detail').classList.add('hidden');
            document.getElementById('main-menu').classList.remove('hidden');
            renderFavorites();
        }

        function toggleMap(show) { document.getElementById('map-modal').classList.toggle('hidden', !show); }
        window.onload = renderFavorites;
    </script>
</body>
</html>
